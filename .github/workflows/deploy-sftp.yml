name: ğŸš€ Deploy Valora.vip via SFTP (Alternative)

# Workflow alternativo usando SFTP en lugar de FTP
# Ãšsalo si el servidor no soporta FTP regular

on:
  workflow_dispatch:  # Solo ejecuciÃ³n manual
  
jobs:
  deploy-sftp:
    runs-on: ubuntu-latest
    name: ğŸ” Deploy via SFTP (Secure)
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ” Setup PHP Environment  
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.1'
        extensions: mbstring, xml, ctype, iconv, intl, pdo, mysql, gd
        
    - name: ğŸ“¦ Install Dependencies
      run: |
        composer install --no-dev --optimize-autoloader --no-interaction
        
    - name: ğŸ” Deploy via SFTP
      uses: wlixcc/SFTP-Deploy-Action@v1.2.4
      with:
        server: ${{ secrets.FTP_HOST }}
        username: ${{ secrets.FTP_USERNAME }}  
        password: ${{ secrets.FTP_PASSWORD }}
        port: 22
        local_path: './'
        remote_path: '/public_html/'
        args: '-o ConnectTimeout=5'
        
    - name: ğŸ“§ SFTP Deploy Status
      if: always()
      run: |
        if [ "${{ job.status }}" == "success" ]; then
          echo "âœ… SFTP Deploy exitoso"
          echo "ğŸ” ConexiÃ³n segura establecida"
          echo "ğŸŒ Sitio: https://valora.vip"
        else
          echo "âŒ SFTP Deploy fallÃ³"
          echo "ğŸ” Verifica que el servidor soporte SFTP en puerto 22"
        fi